<!doctype html>
<head><meta charset="utf-8">
<title>Promise.any</title><script type="application/json" id="menu-search-biblio">[{"type":"clause","id":"sec-native-error-types-used-in-this-standard-aggregateerror","aoid":null,"title":"AggregateError ( errors, message )","titleHTML":"AggregateError ( errors, message )","number":"1","namespace":"https://tc39.github.io/proposal-promise-any/","location":"","referencingIds":[],"key":"AggregateError ( errors, message )"},{"type":"clause","id":"intro","aoid":null,"title":"Introduction","titleHTML":"Introduction","number":"","namespace":"https://tc39.github.io/proposal-promise-any/","location":"","referencingIds":[],"key":"Introduction"},{"type":"op","aoid":"PerformPromiseAny","refId":"sec-performpromiseany","location":"","referencingIds":[],"key":"PerformPromiseAny"},{"type":"clause","id":"sec-performpromiseany","aoid":"PerformPromiseAny","title":"Runtime Semantics: PerformPromiseAny ( iteratorRecord, constructor, resultCapability )","titleHTML":"Runtime Semantics: PerformPromiseAny ( <var>iteratorRecord</var>, <var>constructor</var>, <var>resultCapability</var> )","number":"2.1","namespace":"https://tc39.github.io/proposal-promise-any/","location":"","referencingIds":["_ref_12"],"key":"Runtime Semantics: PerformPromiseAny ( iteratorRecord, constructor, resultCapability )"},{"type":"clause","id":"sec-promise.any-reject-element-functions","aoid":null,"title":"Promise.any Reject Element Functions","titleHTML":"<code>Promise.any</code> Reject Element Functions","number":"2.2","namespace":"https://tc39.github.io/proposal-promise-any/","location":"","referencingIds":["_ref_0"],"key":"Promise.any Reject Element Functions"},{"type":"clause","id":"sec-promise.any","aoid":null,"title":"Promise.any ( iterable )","titleHTML":"Promise.any ( <var>iterable</var> )","number":"2","namespace":"https://tc39.github.io/proposal-promise-any/","location":"","referencingIds":[],"key":"Promise.any ( iterable )"}]</script></head><body><div id="menu-toggle">☰</div><div id="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-native-error-types-used-in-this-standard-aggregateerror" title="AggregateError ( errors, message )"><span class="secnum">1</span> AggregateError ( errors, message )</a></li><li><span class="item-toggle-none"></span><a href="#intro" title="Introduction">Introduction</a></li><li><span class="item-toggle">◢</span><a href="#sec-promise.any" title="Promise.any ( iterable )"><span class="secnum">2</span> Promise.any ( <var>iterable</var> )</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-performpromiseany" title="Runtime Semantics: PerformPromiseAny ( iteratorRecord, constructor, resultCapability )"><span class="secnum">2.1</span> RS: PerformPromiseAny ( <var>iteratorRecord</var>, <var>constructor</var>, <var>resultCapability</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-promise.any-reject-element-functions" title="Promise.any Reject Element Functions"><span class="secnum">2.2</span> <code>Promise.any</code> Reject Element Functions</a></li></ol></li></ol></div></div><div id="spec-container"><h1 class="version first">Stage 1 Draft / April 17, 2019</h1><h1 class="title">Promise.any</h1>
<script src="ecmarkup.js" defer=""></script>
<link rel="stylesheet" href="ecmarkup.css">
<style>
  ins.block {
    font-weight: bold;
    font-style: italic;
  }
  hr {
    height: 0.25em;
    background: #ccc;
    border: 0;
    margin: 2em 0;
  }
  .unicode-property-table {
    table-layout: fixed;
    width: 100%;
    font-size: 80%;
  }
  .unicode-property-table ul {
    padding-left: 0;
    list-style: none;
  }

</style>

<emu-clause id="sec-native-error-types-used-in-this-standard-aggregateerror">
  <h1><span class="secnum">1</span>AggregateError ( errors, message )</h1>
  <p>When the <emu-val>AggregateError</emu-val> function is called with arguments <var>errors</var> and <var>message</var>, the following steps are taken:</p>
  <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, let <var>newTarget</var> be the <emu-xref href="#active-function-object"><a href="https://tc39.github.io/ecma262/#active-function-object">active function object</a></emu-xref>, else let <var>newTarget</var> be NewTarget.</li><li>Let O be ?&nbsp;<emu-xref aoid="OrdinaryCreateFromConstructor" id="_ref_1"><a href="https://tc39.github.io/ecma262/#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a></emu-xref>(<var>newTarget</var>, <code>"%AggregateErrorPrototype%"</code>, « [[ErrorData]] »).</li><li>Let <var>errorsIterator</var> be ?&nbsp;<emu-xref aoid="GetMethod" id="_ref_2"><a href="https://tc39.github.io/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>errors</var>, @@iterator).</li><li>Let <var>errorsList</var> ?&nbsp;<emu-xref aoid="IterableToList" id="_ref_3"><a href="https://tc39.github.io/ecma262/#sec-iterabletolist">IterableToList</a></emu-xref>(<var>errors</var>, <var>errorsIterator</var>).</li><li>Let <var>errorsArray</var> be <emu-xref aoid="CreateArrayFromList" id="_ref_4"><a href="https://tc39.github.io/ecma262/#sec-createarrayfromlist">CreateArrayFromList</a></emu-xref>(<var>errorsList</var>).</li><li>Perform !&nbsp;<emu-xref aoid="CreateDataProperty" id="_ref_5"><a href="https://tc39.github.io/ecma262/#sec-createdataproperty">CreateDataProperty</a></emu-xref>(<var>O</var>, <code>"errors"</code>, <var>errorsArray</var>).</li><li>If <var>message</var> is not <var>undefined</var>, then<ol><li>Let msg be ?&nbsp;<emu-xref aoid="ToString" id="_ref_6"><a href="https://tc39.github.io/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>message</var>).</li><li>Let msgDesc be the PropertyDescriptor { [[Value]]: <var>msg</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>true</emu-val> }.</li><li>Perform !&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_7"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>O</var>, <code>"message"</code>, <var>msgDesc</var>).</li></ol></li><li>Return <var>O</var>.
  </li></ol></emu-alg>
</emu-clause>

<emu-intro id="intro">
  <h1>Introduction</h1>
  <p><code>Promise.any()</code> accepts an array of promises and returns a promise that is fulfilled by the first given promise to be fulfilled, or rejected with an array of rejection reasons if all of the given promises are rejected.</p>
</emu-intro>

<emu-clause id="sec-promise.any">
  <h1><span class="secnum">2</span>Promise.any ( <var>iterable</var> )</h1>
  <p>The <code>any</code> function returns a promise that is fulfilled by the first given promise to be fulfilled, or rejected with an array of rejection reasons if all of the given promises are rejected. It resolves all elements of the passed iterable to promises as it runs this algorithm.</p>
  <emu-alg><ol><li>Let <var>C</var> be the <emu-val>this</emu-val> value.</li><li>If <emu-xref aoid="Type" id="_ref_8"><a href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>C</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>promiseCapability</var> be ?&nbsp;<emu-xref aoid="NewPromiseCapability" id="_ref_9"><a href="https://tc39.github.io/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<var>C</var>).</li><li>Let <var>iteratorRecord</var> be <emu-xref aoid="GetIterator" id="_ref_10"><a href="https://tc39.github.io/ecma262/#sec-getiterator">GetIterator</a></emu-xref>(<var>iterable</var>).</li><li><emu-xref aoid="IfAbruptRejectPromise" id="_ref_11"><a href="https://tc39.github.io/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>iteratorRecord</var>, <var>promiseCapability</var>).</li><li>Let <var>result</var> be <emu-xref aoid="PerformPromiseAny" id="_ref_12"><a href="#sec-performpromiseany">PerformPromiseAny</a></emu-xref>(<var>iteratorRecord</var>, <var>C</var>, <var>promiseCapability</var>).</li><li>If <var>result</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>If <var>iteratorRecord</var>.[[Done]] is <emu-val>false</emu-val>, set <var>result</var> to <emu-xref aoid="IteratorClose" id="_ref_13"><a href="https://tc39.github.io/ecma262/#sec-iteratorclose">IteratorClose</a></emu-xref>(<var>iteratorRecord</var>, <var>result</var>).</li><li><emu-xref aoid="IfAbruptRejectPromise" id="_ref_14"><a href="https://tc39.github.io/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li></ol></li><li>Return <emu-xref aoid="Completion" id="_ref_15"><a href="https://tc39.github.io/ecma262/#sec-completion-record-specification-type">Completion</a></emu-xref>(<var>result</var>).
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>The <code>any</code> function requires its <emu-val>this</emu-val> value to be a constructor function that supports the parameter conventions of the <code>Promise</code> constructor.</p>
  </div></emu-note>

  <emu-clause id="sec-performpromiseany" aoid="PerformPromiseAny">
    <h1><span class="secnum">2.1</span>Runtime Semantics: PerformPromiseAny ( <var>iteratorRecord</var>, <var>constructor</var>, <var>resultCapability</var> )</h1>
    <p>When the PerformPromiseAny abstract operation is called with arguments <var>iteratorRecord</var>, <var>constructor</var>, and <var>resultCapability</var>, the following steps are taken:</p>
    <emu-alg><ol><li>Assert: !&nbsp;<emu-xref aoid="IsConstructor" id="_ref_16"><a href="https://tc39.github.io/ecma262/#sec-isconstructor">IsConstructor</a></emu-xref>(<var>constructor</var>) is <emu-val>true</emu-val>.</li><li>Assert: <var>resultCapability</var> is a PromiseCapability <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref>.</li><li>Let <var>values</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>remainingElementsCount</var> be a new <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { [[Value]]: 1 }.</li><li>Let <var>index</var> be 0.</li><li>Repeat,<ol><li>Let <var>next</var> be <emu-xref aoid="IteratorStep" id="_ref_17"><a href="https://tc39.github.io/ecma262/#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iteratorRecord</var>).</li><li>If <var>next</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, set <var>iteratorRecord</var>.[[Done]] to <emu-val>true</emu-val>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_18"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>next</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, then<ol><li>Set <var>iteratorRecord</var>.[[Done]] to <emu-val>true</emu-val>.</li><li>Set <var>remainingElementsCount</var>.[[Value]] to <var>remainingElementsCount</var>.[[Value]] - 1.</li><li>If <var>remainingElementsCount</var>.[[Value]] is 0, then<ol><li>Let <var>valuesArray</var> be <emu-xref aoid="CreateArrayFromList" id="_ref_19"><a href="https://tc39.github.io/ecma262/#sec-createarrayfromlist">CreateArrayFromList</a></emu-xref>(<var>values</var>).</li><li>Perform ?&nbsp;<emu-xref aoid="Call" id="_ref_20"><a href="https://tc39.github.io/ecma262/#sec-call">Call</a></emu-xref>(<var>resultCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, « <var>valuesArray</var> »).</li></ol></li><li>Return <var>resultCapability</var>.[[Promise]].</li></ol></li><li>Let <var>nextValue</var> be <emu-xref aoid="IteratorValue" id="_ref_21"><a href="https://tc39.github.io/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>If <var>nextValue</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, set <var>iteratorRecord</var>.[[Done]] to <emu-val>true</emu-val>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_22"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>nextValue</var>).</li><li>Append <emu-val>undefined</emu-val> to <var>values</var>.</li><li>Let <var>nextPromise</var> be ?&nbsp;<emu-xref aoid="Invoke" id="_ref_23"><a href="https://tc39.github.io/ecma262/#sec-invoke">Invoke</a></emu-xref>(<var>constructor</var>, <code>"resolve"</code>, « <var>nextValue</var> »).</li><li>Let <var>steps</var> be the algorithm steps defined in <emu-xref href="#sec-promise.any-reject-element-functions" title="" id="_ref_0"><a href="#sec-promise.any-reject-element-functions"><code>Promise.any</code> Reject Element Functions</a></emu-xref>.</li><li>Let <var>rejectElement</var> be <emu-xref aoid="CreateBuiltinFunction" id="_ref_24"><a href="https://tc39.github.io/ecma262/#sec-createbuiltinfunction">CreateBuiltinFunction</a></emu-xref>(<var>steps</var>, « [[AlreadyCalled]], [[Index]], [[Values]], [[Capability]], [[RemainingElements]] »).</li><li>Set <var>rejectElement</var>.[[AlreadyCalled]] to a new <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { [[Value]]: <emu-val>false</emu-val> }.</li><li>Set <var>rejectElement</var>.[[Index]] to <var>index</var>.</li><li>Set <var>rejectElement</var>.[[Values]] to <var>values</var>.</li><li>Set <var>rejectElement</var>.[[Capability]] to <var>resultCapability</var>.</li><li>Set <var>rejectElement</var>.[[RemainingElements]] to <var>remainingElementsCount</var>.</li><li>Set <var>remainingElementsCount</var>.[[Value]] to <var>remainingElementsCount</var>.[[Value]] + 1.</li><li>Perform ?&nbsp;<emu-xref aoid="Invoke" id="_ref_25"><a href="https://tc39.github.io/ecma262/#sec-invoke">Invoke</a></emu-xref>(<var>nextPromise</var>, <code>"then"</code>, « <var>resultCapability</var>, <var>rejectElement</var>[[Reject]] »).</li><li>Increase <var>index</var> by 1.
    </li></ol></li></ol></emu-alg>
  </emu-clause>

  <emu-clause id="sec-promise.any-reject-element-functions">
    <h1><span class="secnum">2.2</span><code>Promise.any</code> Reject Element Functions</h1>
    <p>A <code>Promise.any</code> reject element function is an anonymous built-in function that is used to reject a specific <code>Promise.any</code> element. Each <code>Promise.any</code> reject element function has [[Index]], [[Values]], [[Capability]], [[RemainingElements]], and [[AlreadyCalled]] internal slots.</p>
    <p>When a <code>Promise.any</code> reject element function is called with argument <var>x</var>, the following steps are taken:</p>
    <emu-alg><ol><li>Let <var>F</var> be the <emu-xref href="#active-function-object"><a href="https://tc39.github.io/ecma262/#active-function-object">active function object</a></emu-xref>.</li><li>Let <var>alreadyCalled</var> be <var>F</var>.[[AlreadyCalled]].</li><li>If <var>alreadyCalled</var>.[[Value]] is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Set <var>alreadyCalled</var>.[[Value]] to <emu-val>true</emu-val>.</li><li>Let <var>index</var> be <var>F</var>.[[Index]].</li><li>Let <var>values</var> be <var>F</var>.[[Values]].</li><li>Let <var>promiseCapability</var> be <var>F</var>.[[Capability]].</li><li>Let <var>remainingElementsCount</var> be <var>F</var>.[[RemainingElements]].</li><li>Set <var>values</var>[<var>index</var>] to <var>x</var>.</li><li>Set <var>remainingElementsCount</var>.[[Value]] to <var>remainingElementsCount</var>.[[Value]] - 1.</li><li>If <var>remainingElementsCount</var>.[[Value]] is 0, then<ol><li>Let <var>valuesArray</var> be <emu-xref aoid="CreateArrayFromList" id="_ref_26"><a href="https://tc39.github.io/ecma262/#sec-createarrayfromlist">CreateArrayFromList</a></emu-xref>(<var>values</var>).</li><li>Return ?&nbsp;<emu-xref aoid="Call" id="_ref_27"><a href="https://tc39.github.io/ecma262/#sec-call">Call</a></emu-xref>(<emu-val>undefined</emu-val>, <var>promiseCapability</var>.[[Reject]], « <var>valuesArray</var> »).</li></ol></li><li>Return <emu-val>undefined</emu-val>.
    </li></ol></emu-alg>
    <p>The <code>"length"</code> property of a <code>Promise.any</code> resolve element function is 1.</p>
  </emu-clause>
</emu-clause>
</div></body>